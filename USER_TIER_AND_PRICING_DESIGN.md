# meteor-shower 用户分层与定价体系设计文档

## 📋 文档概述

**文档版本**: v1.0  
**创建日期**: 2025-10-14  
**状态**: 规划中  
**负责模块**: `packages/user-tier`, `packages/enterprise` (扩展)

---

## 🎯 设计目标

### 核心目标
1. **建立清晰的用户分层体系**：免费版 → 个人专业版 → 团队版 → 企业版
2. **实现可持续的商业模式**：免费用户基础 + C端付费 + B端企业盈利
3. **数据治理分级管理**：私有 → 团队内 → 企业内 → 互联网公开
4. **差异化功能设计**：针对不同用户群体提供专属功能和价值

### 运营策略
- **免费用户**：提供核心功能，建立用户基础，形成口碑传播
- **个人付费用户**：提供高级功能，满足专业开发者需求，C端盈利来源
- **团队版用户**：协作功能增强，中小团队工作流优化
- **企业用户**：专属企业功能，定制化服务，核心盈利来源

---

## 👥 用户分层体系

### 1️⃣ 免费版 (Free Tier)

**定位**: 个人开发者入门体验，建立用户基础

#### 功能权限
✅ **核心功能（完整支持）**:
- 本地配置管理（最多 3 个工具）
- 基础模板使用（公开模板库）
- CLI 命令行工具
- 配置备份与恢复（本地）
- 社区模板浏览和下载

✅ **限制性功能**:
- 云端存储：最多 5 个配置模板
- 能力验证案例：每月 20 次执行
- 任务协调：同时管理 3 个任务
- 数据共享：仅支持互联网公开

❌ **不支持的功能**:
- 私有模板云端存储
- 团队协作功能
- 高级分析报告
- 优先技术支持
- 企业级安全功能

#### 数据治理
- **存储位置**: 本地 + 云端（公开模板）
- **数据可见性**: 互联网公开
- **备份策略**: 仅本地备份

#### 使用限制
```typescript
const FREE_TIER_LIMITS = {
  maxTools: 3,                    // 最多配置3个工具
  maxCloudTemplates: 5,           // 云端存储5个模板
  maxValidationRuns: 20,          // 每月20次能力验证
  maxConcurrentTasks: 3,          // 同时3个任务
  storageQuota: '100MB',          // 100MB存储空间
  dataVisibility: ['public'],     // 仅公开数据
};
```

---

### 2️⃣ 个人专业版 (Pro Tier)

**定位**: 专业开发者，高级功能需求，C端盈利核心

**定价**: ¥99/月 或 ¥999/年（节省17%）

#### 功能权限
✅ **免费版所有功能** +

✅ **专业增强功能**:
- 无限工具配置
- 私有模板云端存储（无限）
- 能力验证案例：每月 500 次执行
- 任务协调：同时管理 20 个任务
- 高级数据分析报告
- 模板版本历史（30天）
- 优先技术支持（邮件）

✅ **AI 增强功能**:
- 智能配置推荐
- 个性化最佳实践建议
- 跨工具性能对比分析
- 自动化工作流优化

✅ **数据治理**:
- 私有模板存储
- 数据导出功能
- 加密存储选项

❌ **不支持的功能**:
- 团队协作
- 企业级审批流
- SSO 单点登录
- 定制化开发

#### 数据治理
- **存储位置**: 本地 + 私有云端
- **数据可见性**: 私有 + 可选公开
- **备份策略**: 自动云端备份（7天保留）

#### 使用限制
```typescript
const PRO_TIER_LIMITS = {
  maxTools: Infinity,             // 无限工具
  maxCloudTemplates: Infinity,    // 无限云端模板
  maxValidationRuns: 500,         // 每月500次
  maxConcurrentTasks: 20,         // 同时20个任务
  storageQuota: '10GB',           // 10GB存储
  dataVisibility: ['private', 'public'],
  backupRetention: 7,             // 7天备份
};
```

---

### 3️⃣ 团队版 (Team Tier)

**定位**: 3-50人中小团队，协作功能增强

**定价**: ¥299/用户/月 或 ¥2,999/用户/年（节省17%）  
**最低席位**: 3 个用户

#### 功能权限
✅ **个人专业版所有功能** +

✅ **团队协作功能**:
- 团队工作区管理
- 团队成员权限管理（3级）
- 团队内模板共享
- 协作式配置编辑
- 团队能力验证案例库
- 团队任务看板
- 实时协作编辑

✅ **团队管理功能**:
- 团队使用情况分析
- 成员活动追踪
- 团队最佳实践库
- 集中式配置管理
- 团队审批流（简化版）

✅ **数据治理**:
- 团队内数据共享
- 细粒度权限控制
- 团队数据审计日志

❌ **不支持的功能**:
- 跨部门权限管理
- SSO 单点登录
- 高级审批流
- SLA 服务保障
- 专属客户成功经理

#### 数据治理
- **存储位置**: 团队私有云端
- **数据可见性**: 私有 + 团队内 + 可选公开
- **备份策略**: 自动云端备份（30天保留）
- **权限级别**: 所有者、管理员、成员

#### 使用限制
```typescript
const TEAM_TIER_LIMITS = {
  minSeats: 3,                    // 最少3个席位
  maxSeats: 50,                   // 最多50个席位
  maxTools: Infinity,
  maxCloudTemplates: Infinity,
  maxValidationRuns: 2000,        // 团队共享每月2000次
  maxConcurrentTasks: 100,        // 团队共享100个任务
  storageQuota: '100GB',          // 团队共享100GB
  dataVisibility: ['private', 'team', 'public'],
  backupRetention: 30,
  auditLogRetention: 90,          // 90天审计日志
};
```

---

### 4️⃣ 企业版 (Enterprise Tier)

**定位**: 50人以上大型企业，定制化服务，核心盈利来源

**定价**: 按需定制（联系销售）  
**最低席位**: 50 个用户起

#### 功能权限
✅ **团队版所有功能** +

✅ **企业专属功能**:
- **企业级安全**:
  - SSO 单点登录（SAML 2.0、OAuth 2.0）
  - LDAP/AD 集成
  - 多因素认证 (MFA)
  - IP 白名单
  - 数据加密（传输 + 静态）
  
- **高级治理**:
  - 跨部门权限管理
  - 企业审批工作流（多级）
  - 合规性报告
  - 数据驻留选择（区域）
  - GDPR/等保合规

- **企业工作流**:
  - 自定义审批流程
  - 企业模板库管理
  - 配置变更审计
  - 大规模批量部署
  - 企业内知识库

- **专属服务**:
  - 专属客户成功经理
  - 7×24 技术支持
  - SLA 服务保障（99.9%）
  - 定制化开发
  - 现场培训和咨询
  - 私有化部署选项

✅ **企业分析**:
- 企业级使用分析
- 成本优化建议
- 团队效率报告
- ROI 投资回报分析

#### 数据治理
- **存储位置**: 企业私有云 / 私有化部署
- **数据可见性**: 私有 + 部门 + 企业内 + 可选公开
- **备份策略**: 定制化备份策略（无限保留）
- **权限级别**: 企业管理员、部门管理员、团队管理员、成员、访客

#### 使用限制
```typescript
const ENTERPRISE_TIER_LIMITS = {
  minSeats: 50,                   // 最少50席位
  maxSeats: Infinity,             // 无限席位
  maxTools: Infinity,
  maxCloudTemplates: Infinity,
  maxValidationRuns: Infinity,    // 无限次
  maxConcurrentTasks: Infinity,
  storageQuota: 'Unlimited',      // 无限存储
  dataVisibility: ['private', 'department', 'enterprise', 'public'],
  backupRetention: Infinity,
  auditLogRetention: 365,         // 1年审计日志
  sla: '99.9%',
};
```

---

## 🔐 数据治理模型

### 数据可见性级别

#### 1. 私有 (Private)
- **定义**: 仅创建者本人可见
- **适用范围**: 个人草稿、敏感配置
- **权限控制**: 严格的所有者权限
- **可用层级**: Pro、Team、Enterprise

#### 2. 团队内 (Team)
- **定义**: 团队成员可见
- **适用范围**: 团队协作配置、共享模板
- **权限控制**: 团队成员读权限，管理员写权限
- **可用层级**: Team、Enterprise

#### 3. 部门内 (Department)
- **定义**: 企业内特定部门可见
- **适用范围**: 部门级配置、跨团队共享
- **权限控制**: 部门成员读权限，部门管理员写权限
- **可用层级**: Enterprise

#### 4. 企业内 (Enterprise)
- **定义**: 整个企业组织可见
- **适用范围**: 企业标准模板、最佳实践
- **权限控制**: 企业成员读权限，企业管理员写权限
- **可用层级**: Enterprise

#### 5. 互联网公开 (Public)
- **定义**: 所有互联网用户可见
- **适用范围**: 开源模板、社区贡献
- **权限控制**: 所有人可读，创建者可写
- **可用层级**: 所有层级

### 数据治理矩阵

| 数据类型 | Free | Pro | Team | Enterprise |
|---------|------|-----|------|------------|
| 本地配置 | ✅ | ✅ | ✅ | ✅ |
| 私有云端模板 | ❌ | ✅ | ✅ | ✅ |
| 团队共享模板 | ❌ | ❌ | ✅ | ✅ |
| 部门共享模板 | ❌ | ❌ | ❌ | ✅ |
| 企业模板库 | ❌ | ❌ | ❌ | ✅ |
| 公开社区模板 | ✅ | ✅ | ✅ | ✅ |
| 数据加密 | ❌ | ✅ | ✅ | ✅ |
| 审计日志 | ❌ | ❌ | ✅ (90天) | ✅ (365天) |
| 合规报告 | ❌ | ❌ | ❌ | ✅ |

### 权限模型

#### 角色定义

**免费版/个人专业版**:
- `owner`: 所有者（唯一）

**团队版**:
- `team_owner`: 团队所有者
- `team_admin`: 团队管理员
- `team_member`: 团队成员

**企业版**:
- `enterprise_admin`: 企业超级管理员
- `department_admin`: 部门管理员
- `team_admin`: 团队管理员
- `member`: 普通成员
- `guest`: 访客（只读）

#### 权限矩阵

| 操作 | Owner | Team Admin | Team Member | Dept Admin | Enterprise Admin |
|------|-------|------------|-------------|------------|------------------|
| 创建私有模板 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 创建团队模板 | - | ✅ | ✅ | ✅ | ✅ |
| 管理团队成员 | - | ✅ | ❌ | ✅ | ✅ |
| 配置审批流 | - | ✅ | ❌ | ✅ | ✅ |
| 跨部门共享 | - | - | - | ✅ | ✅ |
| 企业设置 | - | - | - | ❌ | ✅ |
| 查看审计日志 | - | ✅ (团队) | ❌ | ✅ (部门) | ✅ (全部) |

---

## 💰 定价策略

### 定价表

| 层级 | 月付 | 年付 | 节省 | 席位要求 |
|------|------|------|------|---------|
| 免费版 | ¥0 | ¥0 | - | 1 |
| 个人专业版 | ¥99 | ¥999 | 17% | 1 |
| 团队版 | ¥299/席位 | ¥2,999/席位 | 17% | 3-50 |
| 企业版 | 联系销售 | 联系销售 | 定制 | 50+ |

### 功能对比表

| 功能类别 | 免费版 | 个人专业版 | 团队版 | 企业版 |
|---------|--------|-----------|--------|--------|
| **工具配置** | 3个 | 无限 | 无限 | 无限 |
| **云端模板** | 5个 | 无限 | 无限 | 无限 |
| **能力验证** | 20次/月 | 500次/月 | 2000次/月 | 无限 |
| **并发任务** | 3个 | 20个 | 100个 | 无限 |
| **存储空间** | 100MB | 10GB | 100GB | 无限 |
| **团队协作** | ❌ | ❌ | ✅ | ✅ |
| **SSO登录** | ❌ | ❌ | ❌ | ✅ |
| **审批流** | ❌ | ❌ | 简化版 | 完整版 |
| **技术支持** | 社区 | 邮件 | 优先邮件 | 7×24 |
| **SLA** | - | - | - | 99.9% |
| **私有部署** | ❌ | ❌ | ❌ | ✅ |

### 增值服务（可选购买）

**适用于所有付费版本**:
- 额外存储空间：¥50/100GB/月
- 额外能力验证次数：¥100/1000次
- 专业咨询服务：¥800/小时
- 定制开发：按需报价

**企业版专属**:
- 现场培训：¥10,000/天
- 私有化部署：¥100,000起
- 专属支持团队：¥50,000/月

---

## 🚀 实施计划

### Phase 1: 基础架构（2周）
**目标**: 建立用户分层基础设施

- [ ] 创建 `packages/user-tier` 包
- [ ] 实现用户层级管理系统
- [ ] 设计数据库 schema（用户、组织、权限）
- [ ] 实现基础权限检查中间件
- [ ] 集成到现有 `packages/enterprise` 模块

**交付物**:
- `UserTierManager` 类
- `PermissionChecker` 中间件
- 数据库迁移脚本
- 单元测试

### Phase 2: 数据治理（2周）
**目标**: 实现分级数据治理模型

- [ ] 实现数据可见性控制
- [ ] 创建权限矩阵验证系统
- [ ] 实现团队/部门/企业隔离
- [ ] 添加数据加密功能
- [ ] 实现审计日志系统

**交付物**:
- `DataGovernance` 模块
- `AuditLogger` 服务
- 加密存储实现
- 集成测试

### Phase 3: 功能限制（1周）
**目标**: 各层级功能限制实施

- [ ] 实现配额管理系统
- [ ] 添加功能开关控制
- [ ] 实现使用量统计
- [ ] 创建限制提示 UI
- [ ] 升级引导流程

**交付物**:
- `QuotaManager` 类
- `FeatureGate` 装饰器
- 使用量统计仪表板

### Phase 4: 支付集成（2周）
**目标**: 订阅和支付功能

- [ ] 集成支付网关（支付宝/微信支付）
- [ ] 实现订阅管理系统
- [ ] 创建账单和发票功能
- [ ] 实现自动续费
- [ ] 退款和取消流程

**交付物**:
- 支付 API 集成
- 订阅管理界面
- 账单系统

### Phase 5: UI/UX 优化（1周）
**目标**: 定价页面和用户体验

- [ ] 设计定价页面
- [ ] 创建升级流程
- [ ] 实现功能对比表
- [ ] 添加试用期功能（14天）
- [ ] 优化购买体验

**交付物**:
- 定价页面
- 升级向导
- 试用管理系统

---

## 📊 成功指标

### 商业指标
- **用户转化率**: 免费 → 付费 > 5%
- **付费用户留存**: 6个月留存 > 80%
- **企业客户年均价值 (ACV)**: > ¥100,000
- **月经常性收入 (MRR)**: 持续增长

### 用户指标
- **免费用户月活**: 基础规模 > 10,000
- **个人专业版用户**: > 500
- **团队版用户**: > 50 团队
- **企业版客户**: > 10 企业

### 产品指标
- **功能使用率**: 核心功能 > 70%
- **用户满意度 (NPS)**: > 50
- **支持响应时间**: < 2 小时（付费用户）

---

## 🔄 迭代优化

### 短期优化（3个月）
- 收集用户反馈，调整功能边界
- 优化定价策略
- 完善企业专属功能
- 增强数据安全性

### 中期优化（6个月）
- 推出行业解决方案
- 开发集成市场
- 建立合作伙伴体系
- 国际化扩展

### 长期规划（12个月）
- AI 驱动的智能推荐
- 行业认证和合规
- 生态系统建设
- 全球市场扩张

---

## 📝 附录

### A. 竞品对比

| 产品 | 免费版 | 个人版 | 团队版 | 企业版 |
|------|--------|--------|--------|--------|
| meteor-shower | ✅ | ¥99/月 | ¥299/席位 | 定制 |
| Cursor | ❌ | $20/月 | $40/席位 | 联系销售 |
| GitHub Copilot | ❌ | $10/月 | $19/席位 | $39/席位 |

### B. 技术架构图

```
┌─────────────────────────────────────────────────────────┐
│                     用户层级系统                          │
├─────────────────────────────────────────────────────────┤
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │
│  │ 免费版   │  │ 专业版   │  │ 团队版   │  │ 企业版   │ │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘ │
│       │             │             │             │       │
├───────┴─────────────┴─────────────┴─────────────┴───────┤
│              权限管理 & 功能开关层                        │
├─────────────────────────────────────────────────────────┤
│  ┌──────────────────┐  ┌──────────────────┐            │
│  │ 配额管理         │  │ 数据治理         │            │
│  └──────────────────┘  └──────────────────┘            │
├─────────────────────────────────────────────────────────┤
│              核心业务逻辑 (现有模块)                      │
│  CLI / Cloud Hub / 能力验证 / 任务协调                   │
└─────────────────────────────────────────────────────────┘
```

### C. 数据模型 Schema

```typescript
// 用户表
interface User {
  id: string;
  email: string;
  tier: 'free' | 'pro' | 'team' | 'enterprise';
  subscription: {
    status: 'active' | 'cancelled' | 'expired';
    startDate: Date;
    endDate: Date;
    autoRenew: boolean;
  };
  organizationId?: string;
  usage: {
    storageUsed: number;
    validationRunsThisMonth: number;
    activeTasks: number;
  };
}

// 组织表
interface Organization {
  id: string;
  name: string;
  tier: 'team' | 'enterprise';
  seats: {
    total: number;
    used: number;
  };
  subscription: SubscriptionInfo;
  settings: OrganizationSettings;
}

// 权限表
interface Permission {
  userId: string;
  resource: string;
  action: 'read' | 'write' | 'delete' | 'admin';
  scope: 'private' | 'team' | 'department' | 'enterprise' | 'public';
}
```

---

**文档维护**: 本文档将随着产品迭代持续更新  
**反馈渠道**: product@meteor-shower.com
