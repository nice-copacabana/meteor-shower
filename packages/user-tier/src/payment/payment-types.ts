// Generated by Qoder AI (Model: claude-sonnet-4-5-20250929) - 2025-10-15
// Task: M6 Phase4 - 支付网关接口定义

/**
 * 支付提供商枚举
 */
export enum PaymentProvider {
  /** 支付宝 */
  ALIPAY = 'alipay',
  
  /** 微信支付 */
  WECHAT = 'wechat',
  
  /** Stripe (国际支付) */
  STRIPE = 'stripe',
}

/**
 * 支付状态
 */
export enum PaymentStatus {
  /** 待支付 */
  PENDING = 'pending',
  
  /** 支付中 */
  PROCESSING = 'processing',
  
  /** 支付成功 */
  SUCCESS = 'success',
  
  /** 支付失败 */
  FAILED = 'failed',
  
  /** 已取消 */
  CANCELLED = 'cancelled',
  
  /** 已退款 */
  REFUNDED = 'refunded',
}

/**
 * 支付方式
 */
export enum PaymentMethod {
  /** 扫码支付 */
  QR_CODE = 'qr_code',
  
  /** H5支付 */
  H5 = 'h5',
  
  /** APP支付 */
  APP = 'app',
  
  /** 网页支付 */
  WEB = 'web',
}

/**
 * 货币类型
 */
export enum Currency {
  /** 人民币 */
  CNY = 'CNY',
  
  /** 美元 */
  USD = 'USD',
}

/**
 * 支付订单
 */
export interface PaymentOrder {
  /** 订单ID */
  id: string;
  
  /** 用户ID */
  userId: string;
  
  /** 订阅ID (如果是订阅支付) */
  subscriptionId?: string;
  
  /** 支付提供商 */
  provider: PaymentProvider;
  
  /** 支付方式 */
  method: PaymentMethod;
  
  /** 金额 (分) */
  amount: number;
  
  /** 货币 */
  currency: Currency;
  
  /** 订单标题 */
  title: string;
  
  /** 订单描述 */
  description?: string;
  
  /** 支付状态 */
  status: PaymentStatus;
  
  /** 第三方交易号 */
  transactionId?: string;
  
  /** 支付时间 */
  paidAt?: Date;
  
  /** 创建时间 */
  createdAt: Date;
  
  /** 过期时间 */
  expiresAt: Date;
  
  /** 回调URL */
  callbackUrl?: string;
  
  /** 额外元数据 */
  metadata?: Record<string, any>;
}

/**
 * 支付请求参数
 */
export interface CreatePaymentRequest {
  userId: string;
  subscriptionId?: string;
  provider: PaymentProvider;
  method: PaymentMethod;
  amount: number;
  currency: Currency;
  title: string;
  description?: string;
  callbackUrl?: string;
  metadata?: Record<string, any>;
}

/**
 * 支付响应
 */
export interface PaymentResponse {
  /** 订单ID */
  orderId: string;
  
  /** 支付URL (用于跳转) */
  paymentUrl?: string;
  
  /** 二维码数据 (用于扫码) */
  qrCode?: string;
  
  /** 其他支付参数 */
  params?: Record<string, any>;
}

/**
 * 支付回调数据
 */
export interface PaymentCallback {
  /** 订单ID */
  orderId: string;
  
  /** 支付提供商 */
  provider: PaymentProvider;
  
  /** 支付状态 */
  status: PaymentStatus;
  
  /** 第三方交易号 */
  transactionId: string;
  
  /** 支付金额 */
  amount: number;
  
  /** 支付时间 */
  paidAt: Date;
  
  /** 原始回调数据 */
  rawData: Record<string, any>;
}

/**
 * 支付网关接口
 */
export interface PaymentGateway {
  /**
   * 创建支付订单
   */
  createPayment(request: CreatePaymentRequest): Promise<PaymentResponse>;
  
  /**
   * 查询支付状态
   */
  queryPayment(orderId: string): Promise<PaymentOrder>;
  
  /**
   * 处理支付回调
   */
  handleCallback(rawData: Record<string, any>): Promise<PaymentCallback>;
  
  /**
   * 验证回调签名
   */
  verifyCallback(rawData: Record<string, any>): boolean;
  
  /**
   * 取消支付
   */
  cancelPayment(orderId: string): Promise<boolean>;
  
  /**
   * 申请退款
   */
  refund(orderId: string, amount: number, reason?: string): Promise<boolean>;
}

/**
 * 支付配置
 */
export interface PaymentConfig {
  /** 支付宝配置 */
  alipay?: {
    appId: string;
    privateKey: string;
    publicKey: string;
    gatewayUrl: string;
  };
  
  /** 微信支付配置 */
  wechat?: {
    appId: string;
    mchId: string;
    apiKey: string;
    certPath?: string;
  };
  
  /** Stripe配置 */
  stripe?: {
    publicKey: string;
    secretKey: string;
  };
}
